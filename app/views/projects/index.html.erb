<h1>CrowdFUNder Projects</h1>

<%= link_to "Create a New Project!", new_project_url %>

<%= form_tag projects_path, method: :get, authentication: false, id: 'search-form' do %>
  <%= text_field_tag :search, params[:search], :placeholder => 'Search Project Name' %>
  <%= submit_tag "Search" %>
<% end -%>

<% @projects.each do |project| %>
<p>
<h3>Name: <%= project[:name]%></h3>
Description: <%= project[:description]%><br />
Goal: <%= project[:goal]%><br />
Start Date: <%= project[:start_date]%><br />
End Date: <%= project[:end_date]%> <br />
Current Funding: $<%= project.current_funding %> <br />
Amount Left: <%= project.funding_left %> <br>

<%= link_to "Show", project %>
</p>
<% end %>

<script type="text/javascript">
  function display_search_results() {
    // readyState === 4 means that the asynchronous request completed successfully
    if (this.readyState === 4) {
      console.log(this);
      document.getElementById('projects').innerHTML = this.responseText;
    }
  }

  var form = document.getElementById('search-form');
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    var searchValue = document.getElementById('search').value;

    var xhr = new XMLHttpRequest();
    xhr.onload = display_search_results;
    xhr.open('GET', '/projects?search=' + searchValue, true);
    xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
    xhr.send();
  });
</script>
